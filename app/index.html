<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="initial-scale=1" />

  <base href="/">

  <title>Nexus Knowledge Graph Browser</title>

  <!-- css files -->
  <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:400,700'>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="/node_modules/angular-material/angular-material.css"/>
  <link rel="stylesheet" href="/app/app.css">

  <!-- angular stuff -->
  <script src="/node_modules/angular/angular.js"></script>
  <script src="/node_modules/angular-animate/angular-animate.js"></script>
  <script src="/node_modules/angular-aria/angular-aria.js"></script>
  <script src="/node_modules/angular-messages/angular-messages.js"></script>
  <script src="/node_modules/angular-material/angular-material.js"></script>
  
  <!-- authentication/authorization -->
  <script src="/lib/angular-bbp-config/angular-bbp-config.js"></script>
  <script src="/lib/bbp-oidc-client/angular-bbp-oidc-client.js"></script>

  <!-- our angular app -->
  <script src="/app/app.js"></script>
  <script src="/app/services.js"></script>
  <script src="/app/controllers.js"></script>
</head>

<body ng-app="nar" layout="column">

      <!-- Toolbar -->
    <md-toolbar layout="row" class="md-toolbar-tools" ng-controller="MenuController as menu">

      <md-menu md-offset="0 40">
      <md-button class="md-icon-button" aria-label="Menu" ng-click="menu.openMenu($mdMenu, $event)">
        <md-icon>menu</md-icon>
      </md-button>
      <md-menu-content width="4">
        <md-menu-item ng-repeat="type in menu.instance_types">
          <md-button ng-click="menu.select(type, $event)">{{menu.get_type_name(type)}}</md-button>
        </md-menu-item>
      </md-menu-content>
      </md-menu>

      <h1 flex><a href="/app">Nexus Knowledge Graph</a></h1>
    </md-toolbar>

    <!-- Container for sidebar and main content -->
    <div flex layout="row" ng-controller="DefaultController as app">

      <!-- Sidebar -->
      <md-sidenav md-is-locked-open="true" class="md-whiteframe-4dp">
        <md-list ng-if="app.instances">
          <md-list-item>
            <md-button class="md-icon-button" ng-click="app.createInstance()">
                <md-icon>add</md-icon>
            </md-button>
          </md-list-item>

          <md-list-item ng-repeat="instance in app.instances | orderBy:'get_label()'">
            <md-button ng-click="app.selectInstance(instance)" ng-class="{'selected' : instance === app.selected }" md-truncate>
              {{instance.get_label()}}
            </md-button>
          </md-list-item>

        </md-list>

        <div ng-hide="app.instances.length"><md-button>No instances</md-button></div>
      </md-sidenav>

      <!-- Main content -->
      <md-content flex id="content">
        <!-- <div ui-view>Hello, world!</div> -->
        <div ng-show="app.show_readme">
          <p>Welcome to the Nexus Knowledge Graph browser. You are browsing <b>{{app.base_url}}</b></p>
          <p>To get started, select an instance type from the drop-down menu (top-left)</p>
          <p>To report bugs or suggest improvements, please <a href="https://github.com/apdavison/nexus-kg-browser/issues" target="_blank">open an issue</a>.</p>
        </div>

        <h2 class="md-display-1" ng-show="!app.show_readme">{{app.selected.get_label()}} 
          <md-button ng-if="!app.editMode" class="md-icon-button" aria-label="Menu" ng-click="app.editInstance(app.selected)">
            <md-icon>create</md-icon>
          </md-button>
        </h2>
        <h3 class="md-caption"><a href="{{app.selected.id}}" target="_blank" style="text-decoration: none; color:gray">{{app.selected.id}}</a></h3>

        <div ng-if="!app.editMode">
          <md-list>
            <md-list-item ng-repeat="attribute in app.selected.attributes" layout="row" ng-class-odd="'odd'" ng-class-even="'even'">
              <span flex="20"><md-tooltip md-direction="bottom">{{attribute.description || attribute.name}}</md-tooltip>{{attribute.name || attribute.description || attribute.path}}</span>
              <div ng-switch="app.attributeType(attribute)">
                <div flex ng-switch-when="internal-link">
                  <md-icon>chevron_right</md-icon>
                  <md-button ng-click="app.switchTo(attribute.value['@id'])" class="md-primary">{{app.pathFromId(attribute.value['@id']).id}}</md-button>
                </div>
                <div flex ng-switch-when="external-link">
                  {{attribute.value.label}}
                  <md-button href="{{app.resolveId(attribute.value['@id'])}}"
                  title="See definition"
                  target="_blank"
                  class="md-icon-button launch" >
                      <md-icon>launch</md-icon>
                  </md-button>
                </div>
                <div flex ng-switch-when="list-of-links">
                  <md-icon>chevron_right</md-icon>
                  <md-button ng-repeat="subattr in attribute.value" ng-click="app.switchTo(subattr['@id'])" class="md-primary">{{app.pathFromId(subattr['@id']).id}}</md-button>
                </div>
                <div flex ng-switch-when="literal">{{attribute.value}}</div>
                <div flex ng-switch-when="quantity">{{attribute.value.value}} {{attribute.value.label}}</div>
                <div flex ng-switch-when="age">{{attribute.value.value.value}} {{attribute.value.value.label}} ({{attribute.value.period.toLowerCase()}})</div>
                <div flex ng-switch-when="sex">{{attribute.value.label}}</div>
                <div flex ng-switch-when="address">{{attribute.value.addressLocality}}, {{attribute.value.addressCountry}}</div>
                <div flex ng-switch-default>{{attribute.value}}</div>
              </div>
            </md-list-item>
          </md-list>
        </div>

        <div ng-if="app.editMode">
          <form name="userForm">
          <div ng-repeat="attribute in app.selected.attributes">
            <div ng-switch="app.attributeType(attribute)">
              <div ng-switch-when="datetime">
                <md-input-container class="md-block">
                  <label>{{attribute.name || attribute.description}}</label>
                  <md-datepicker ng-model="attribute.value"></md-datepicker>
                </md-input-container>  
              </div>
              <div ng-switch-when="sex">
                <md-input-container class="md-block md-input-has-value">
                  <label>{{attribute.name || attribute.description}}</label>
                  <md-radio-group ng-model="attribute.handleValue" ng-model-options="{ getterSetter: true }" layout="row">
                      <md-radio-button value="male">Male</md-radio-button>
                      <md-radio-button value="female">Female</md-radio-button>
                  </md-radio-group>
                </md-input-container>  
              </div>
              <div ng-switch-when="age" layout="row">
                <md-input-container class="md-block" flex>
                  <label>Age</label>
                  <input ng-model="attribute.value.value.value">
                </md-input-container> 
                <md-input-container class="md-block" flex>
                  <md-select ng-model="attribute.handleUnits" ng-model-options="{ getterSetter: true }" aria-label="units">
                      <md-option value="days">days</md-option>
                      <md-option value="weeks">weeks</md-option>
                      <md-option value="months">months</md-option>
                      <md-option value="years">years</md-option>
                    </md-select>  
                </md-input-container> 
                <md-input-container class="md-block" flex>
                  <md-select ng-model="attribute.value.period" aria-label="period">
                    <md-option value="Post-natal">Post-natal</md-option>
                    <md-option value="Pre-natal">Pre-natal</md-option>
                  </md-select>  
                </md-input-container> 
              </div> 
              <div ng-switch-when="quantity" layout="row">
                <md-input-container class="md-block" flex>
                  <label>{{attribute.name || attribute.description}}</label>
                  <input ng-model="attribute.value.value">
                </md-input-container>  
                <md-input-container class="md-block" flex>
                  <input ng-model="attribute.handleUnits" ng-model-options="{ getterSetter: true }" aria-label="units" >
                </md-input-container>
              </div> 
              <div ng-switch-when="literal">
                <md-input-container class="md-block">
                  <label>{{attribute.name || attribute.description}}</label>
                  <input ng-model="attribute.value">
                </md-input-container>  
              </div> 
              <div ng-switch-default>
                <md-input-container class="md-block">
                  <label>{{attribute.name || attribute.description}}</label>
                  <input ng-model="attribute.value" disabled>
                </md-input-container>  
              </div>
            </div>
          </div>
          <div>
            <md-button type="submit" class="md-raised md-primary" ng-click="app.saveInstance(app.selected)">Submit</md-button>
            <md-button type="cancel" class="md-raised" ng-click="app.editMode=false">Cancel</md-button>
          </div>
          </form>
        </div>

      </md-content>

    </div>


</body>
</html>